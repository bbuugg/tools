import{d as K,u as X,a1 as Z,a2 as ee,r as v,a4 as te,P as se,Q as oe,o as p,a as t,c as h,f as F,t as o,S as le,R as P,e as k,g as D,v as ie,F as re,k as ae,a3 as ne,W as de}from"./index-CB9dnXdB.js";import{u as ue}from"./useToast-PjD2IqXA.js";import{_ as ce}from"./ToolLayout.vue_vue_type_script_setup_true_lang-GQLqlDLw.js";import{G as ge}from"./gif-Dup4naTh.js";import{l as q}from"./index-CNw5tbJV.js";import"./_commonjsHelpers-DsqdWQfm.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";const fe={class:"glass rounded-xl border border-slate-700/30 p-6 mb-6"},me={class:"text-lg font-semibold text-slate-100 mb-3"},pe={class:"list-decimal list-inside space-y-2 text-slate-300 ml-4"},he={class:"glass rounded-xl border border-slate-700/30 p-6 mb-6"},ve={class:"text-lg font-semibold text-slate-100 mb-4 border-b border-slate-700/30 pb-2"},be={class:"mb-6"},we={class:"text-slate-400 mb-4"},ye={class:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors"},xe={class:"text-xs text-slate-500 mt-2"},Ee={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},_e={class:"block text-sm font-medium text-slate-300 mb-2"},$e={class:"text-xs text-slate-500 mt-1"},Fe={class:"block text-sm font-medium text-slate-300 mb-2"},ke={value:"high"},Ue={value:"medium"},Ge={value:"low"},Ie={class:"block text-sm font-medium text-slate-300 mb-2"},Ce={key:0,class:"glass rounded-xl border border-slate-700/30 p-6 mb-6"},De={class:"text-lg font-semibold text-slate-100 mb-4 border-b border-slate-700/30 pb-2"},Le={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Re={class:"text-md font-semibold text-slate-200 mb-3"},Pe={class:"flex items-center justify-center w-full h-64 bg-slate-800/50 rounded-lg"},qe=["src","alt"],Te={key:1,class:"text-center"},je={class:"mt-2 text-slate-400"},Me={class:"mt-2 text-sm text-slate-400"},Oe={class:"text-md font-semibold text-slate-200 mb-3"},Ve={class:"space-y-3 max-h-96 overflow-y-auto"},Se={class:"flex-shrink-0 w-16 h-16 bg-slate-800/50 rounded-md overflow-hidden"},ze=["src","alt"],Be={class:"ml-3 flex-grow min-w-0"},Ne={class:"text-sm font-medium text-slate-100"},Ae={class:"text-xs text-slate-400"},He={class:"text-xs text-slate-400"},We={class:"flex items-center"},Qe=["onUpdate:modelValue","onInput"],Ye=["onClick"],Je={class:"mt-4 flex flex-wrap gap-2"},Ke=["disabled"],Xe=["disabled"],Ze=["disabled"],et=["disabled"],tt={class:"mt-6 flex flex-wrap gap-3"},st=["disabled"],ot={key:1,class:"glass rounded-xl border border-slate-700/30 p-6 mb-6"},lt={class:"text-center"},it={class:"text-lg font-semibold text-slate-100 mb-2"},rt={class:"text-slate-400"},at={class:"mt-4 bg-slate-700 rounded-full h-2"},nt={class:"text-sm text-slate-400 mt-2"},dt={key:0,class:"mt-6"},ut={class:"text-md font-medium text-slate-200 mb-2"},ct=["src"],gt={key:2,class:"glass rounded-xl border border-slate-700/30 p-6 mb-6"},ft={class:"text-lg font-semibold text-slate-100 mb-4 border-b border-slate-700/30 pb-2"},mt={class:"text-center"},pt=["src"],ht={class:"flex justify-center gap-4 flex-wrap"},vt={class:"glass rounded-xl border border-slate-700/30 p-6 mb-6"},bt={class:"text-lg font-semibold text-slate-100 mb-3"},wt={class:"space-y-2 text-slate-300"},yt={class:"flex items-start"},xt={class:"flex items-start"},Et={class:"flex items-start"},_t={class:"flex items-start"},$t=K({__name:"GifEditor",setup(Ft){const{t:d}=X(),{success:U,error:T}=ue();function m(e){T(e)}Z(()=>{document.addEventListener("paste",L)}),ee(()=>{document.removeEventListener("paste",L),a.value?.url&&URL.revokeObjectURL(a.value.url),u.value&&URL.revokeObjectURL(u.value)});async function L(e){const s=e.clipboardData?.items;if(s)for(let l=0;l<s.length;l++){const n=s[l];if(n.type==="image/gif"){const r=n.getAsFile();if(r){const c=new File([r],`pasted-gif-${Date.now()}.gif`,{type:r.type});await G(c),U(d("tools.gifEditor.messages.filePasted"));break}}}}const _=v(),R=v(!1),E=v(!1),b=v(0),u=v(""),a=v(null),i=v([]),f=te({width:300,quality:"medium",fps:10});function j(e){e.preventDefault(),R.value=!1;const s=e.dataTransfer?.files;if(s&&s.length>0){const l=Array.from(s).filter(n=>n.type==="image/gif");l.length>0?G(l[0]):m(d("tools.gifEditor.errors.noGif"))}}function M(e){const s=e.target,l=s.files;if(l&&l.length>0){const n=Array.from(l).filter(r=>r.type==="image/gif");n.length>0?G(n[0]):m(d("tools.gifEditor.errors.noGif"))}s&&(s.value="")}async function G(e){if(e.type!=="image/gif"){m(d("tools.gifEditor.errors.invalidFile"));return}if(e.size>50*1024*1024){m(d("tools.gifEditor.errors.fileTooLarge"));return}try{I();const s=URL.createObjectURL(e);a.value={file:e,url:s,name:e.name,width:0,height:0},await O(e),U(d("tools.gifEditor.messages.fileLoaded"))}catch(s){console.error("Error handling GIF file:",s),m(d("tools.gifEditor.errors.fileProcessing"))}}async function O(e){try{const s=await e.arrayBuffer(),l=q.parseGIF(s);l&&l.lsd&&a.value&&(a.value.width=l.lsd.width,a.value.height=l.lsd.height);const n=q.decompressFrames(l,!0);i.value=[];for(const r of n){if(r.dims.width<=0||r.dims.height<=0){console.warn("Skipping frame with invalid dimensions");continue}const c=document.createElement("canvas");c.width=a.value?.width||r.dims.width,c.height=a.value?.height||r.dims.height;const $=c.getContext("2d",{willReadFrequently:!0});if($){const w=new ImageData(new Uint8ClampedArray(r.patch),r.dims.width,r.dims.height);$.putImageData(w,r.dims.left||0,r.dims.top||0);const y=c.toDataURL("image/png");i.value.push({dataUrl:y,delay:r.delay,imageData:w,left:r.dims.left||0,top:r.dims.top||0,width:r.dims.width,height:r.dims.height,dispose:r.disposalType||0})}}a.value&&(!a.value.width||!a.value.height)&&i.value.length>0&&(a.value.width=i.value[0].imageData.width,a.value.height=i.value[0].imageData.height)}catch(s){console.error("Error parsing GIF frames:",s),m(d("tools.gifEditor.errors.frameParsingFailed"))}}function V(e){i.value.splice(e,1)}function I(){a.value?.url&&URL.revokeObjectURL(a.value.url),u.value&&URL.revokeObjectURL(u.value),a.value=null,i.value=[],u.value="",b.value=0}function S(e,s){const l=s.target,n=parseInt(l.value);!isNaN(n)&&n>=20&&(i.value[e].delay=n)}function z(){if(i.value.length<=1)return;const e=i.value[0];i.value.shift(),i.value.push(e)}function B(){if(i.value.length<=1)return;const e=i.value.pop();e&&i.value.unshift(e)}function N(){i.value.length<=1||i.value.reverse()}function A(){if(!(i.value.length<=1))for(let e=i.value.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[i.value[e],i.value[s]]=[i.value[s],i.value[e]]}}async function H(){if(!a.value||i.value.length===0){m(d("tools.gifEditor.errors.noFrames"));return}if(!i.value.some(e=>e.dataUrl&&e.delay>0)){m(d("tools.gifEditor.errors.noFrames"));return}E.value=!0,b.value=0;try{await W(),U(d("tools.gifEditor.messages.gifGenerated"))}catch(e){console.error("Error generating GIF:",e),m(d("tools.gifEditor.errors.processingFailed")+": "+e.message)}finally{E.value=!1}}async function W(){if(!a.value)return;if(i.value.length===0)throw new Error("No frames to process. Please try another GIF file.");const e=a.value.width,s=a.value.height;if(!e||!s||e<=0||s<=0)throw new Error("Invalid GIF dimensions. Please try another GIF file.");const l=document.createElement("canvas"),n=l.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("Unable to get canvas context. Your browser may not support this feature.");l.width=e,l.height=s;const r={high:1,medium:10,low:20},c=new ge({workers:2,quality:r[f.quality],width:e,height:s,workerScript:"/gif.worker.js",transparent:0}),$=i.value.length;let w=0;for(const y of i.value)try{const g=new Image;if(await new Promise((C,J)=>{g.onload=()=>C(),g.onerror=()=>J(new Error("Failed to load frame image")),g.src=y.dataUrl}),g.width<=0||g.height<=0){console.warn("Skipping frame with invalid dimensions");continue}n.drawImage(g,0,0),c.addFrame(l,{copy:!0,delay:y.delay}),w++,b.value=Math.round(w/$*100)}catch(g){console.error("Error processing frame:",g)}if(w===0)throw new Error("No frames could be processed. Please try another GIF file.");return new Promise((y,g)=>{c.on("finished",x=>{const C=URL.createObjectURL(x);u.value=C,b.value=100,y()}),c.on("abort",()=>{g(new Error("GIF generation was aborted"))}),c.on("error",x=>{g(new Error("GIF generation error: "+x.message))});try{c.render()}catch(x){g(new Error("Failed to start GIF rendering: "+x.message))}})}function Q(){if(!u.value)return;const e=document.createElement("a");e.href=u.value,e.download=`edited-gif-${Date.now()}.gif`,document.body.appendChild(e),e.click(),document.body.removeChild(e)}function Y(){I(),f.width=300,f.quality="medium",f.fps=10,_.value&&(_.value.value="")}return(e,s)=>(p(),se(ce,{title:e.$t("tools.gifEditor.title"),description:e.$t("tools.gifEditor.description"),icon:"ðŸŽžï¸",features:[e.$t("tools.gifEditor.features.frameEditing.title"),e.$t("tools.gifEditor.features.customization.title"),e.$t("tools.gifEditor.features.animation.title")]},{default:oe(()=>[t("div",fe,[t("h3",me,o(e.$t("tools.gifEditor.howToUse.title")),1),t("ol",pe,[t("li",null,o(e.$t("tools.gifEditor.howToUse.step1")),1),t("li",null,o(e.$t("tools.gifEditor.howToUse.step2")),1),t("li",null,o(e.$t("tools.gifEditor.howToUse.step3")),1),t("li",null,o(e.$t("tools.gifEditor.howToUse.step4")),1)])]),t("div",he,[t("h3",ve,o(e.$t("tools.gifEditor.upload.title")),1),t("div",be,[t("div",{onDrop:j,onDragover:s[0]||(s[0]=P(()=>{},["prevent"])),onDragenter:s[1]||(s[1]=P(()=>{},["prevent"])),class:le(["border-2 border-dashed border-slate-600/50 rounded-lg p-8 text-center hover:border-primary-500/50 transition-colors cursor-pointer",{"border-primary-500/50 bg-primary-500/10":R.value}]),onClick:s[2]||(s[2]=l=>_.value.click())},[s[6]||(s[6]=t("div",{class:"text-slate-400 text-4xl mb-4"},"ðŸŽžï¸",-1)),t("p",we,o(e.$t("tools.gifEditor.upload.dragDrop")),1),t("input",{type:"file",ref_key:"fileInput",ref:_,onChange:M,accept:"image/gif",class:"hidden"},null,544),t("button",ye,o(e.$t("tools.gifEditor.upload.selectFile")),1),t("p",xe,o(e.$t("tools.gifEditor.upload.supportedFormats")),1)],34)]),t("div",Ee,[t("div",null,[t("label",_e,o(e.$t("tools.gifEditor.settings.width")),1),k(t("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>f.width=l),type:"number",min:"100",max:"800",class:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700/50 text-slate-100 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200",disabled:""},null,512),[[D,f.width,void 0,{number:!0}]]),t("p",$e,o(e.$t("tools.gifEditor.settings.preserveOriginal")),1)]),t("div",null,[t("label",Fe,o(e.$t("tools.gifEditor.settings.quality")),1),k(t("select",{"onUpdate:modelValue":s[4]||(s[4]=l=>f.quality=l),class:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700/50 text-slate-100 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200"},[t("option",ke,o(e.$t("tools.gifEditor.settings.qualityOptions.high")),1),t("option",Ue,o(e.$t("tools.gifEditor.settings.qualityOptions.medium")),1),t("option",Ge,o(e.$t("tools.gifEditor.settings.qualityOptions.low")),1)],512),[[ie,f.quality]])]),t("div",null,[t("label",Ie,o(e.$t("tools.gifEditor.settings.fps")),1),k(t("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>f.fps=l),type:"number",min:"1",max:"30",class:"w-full px-3 py-2 bg-slate-800/50 border border-slate-700/50 text-slate-100 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200"},null,512),[[D,f.fps,void 0,{number:!0}]])])])]),a.value?(p(),h("div",Ce,[t("h3",De,o(e.$t("tools.gifEditor.preview.title")),1),t("div",Le,[t("div",null,[t("h4",Re,o(e.$t("tools.gifEditor.preview.originalGif")),1),t("div",Pe,[a.value.url?(p(),h("img",{key:0,src:a.value.url,alt:a.value.name,class:"max-h-full max-w-full object-contain"},null,8,qe)):(p(),h("div",Te,[s[7]||(s[7]=t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto"},null,-1)),t("p",je,o(e.$t("tools.gifEditor.loadingGif")),1)]))]),t("div",Me,o(e.$t("tools.gifEditor.preview.dimensions"))+": "+o(a.value.width)+" Ã— "+o(a.value.height)+" "+o(e.$t("tools.gifEditor.preview.pixels")),1)]),t("div",null,[t("h4",Oe,o(e.$t("tools.gifEditor.preview.frames"))+" ("+o(i.value.length)+") ",1),t("div",Ve,[(p(!0),h(re,null,ae(i.value,(l,n)=>(p(),h("div",{key:n,class:"flex items-center p-3 border border-slate-700/50 rounded-lg bg-slate-800/30"},[t("div",Se,[t("img",{src:l.dataUrl,alt:`Frame ${n+1}`,class:"w-full h-full object-cover"},null,8,ze)]),t("div",Be,[t("p",Ne,o(e.$t("tools.gifEditor.preview.frame"))+" "+o(n+1),1),t("p",Ae,o(e.$t("tools.gifEditor.preview.delay"))+": "+o(l.delay)+"ms ",1),t("p",He," Position: ("+o(l.left)+", "+o(l.top)+") "+o(l.width)+"Ã—"+o(l.height),1)]),t("div",We,[k(t("input",{"onUpdate:modelValue":r=>l.delay=r,type:"number",min:"20",max:"5000",step:"10",class:"w-16 px-2 py-1 bg-slate-800/50 border border-slate-700/50 text-slate-100 rounded text-xs focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200",onInput:r=>S(n,r)},null,40,Qe),[[D,l.delay,void 0,{number:!0}]]),s[9]||(s[9]=t("span",{class:"ml-1 text-xs text-slate-400"},"ms",-1)),t("button",{onClick:r=>V(n),class:"ml-2 text-red-500 hover:text-red-400"},[...s[8]||(s[8]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)])],8,Ye)])]))),128))]),t("div",Je,[t("button",{onClick:z,disabled:i.value.length<=1,class:"px-3 py-1 bg-slate-800/50 text-slate-300 rounded text-sm hover:bg-slate-700/50 disabled:opacity-50 border border-slate-700/50 transition-colors"},o(e.$t("tools.gifEditor.preview.moveUp")),9,Ke),t("button",{onClick:B,disabled:i.value.length<=1,class:"px-3 py-1 bg-slate-800/50 text-slate-300 rounded text-sm hover:bg-slate-700/50 disabled:opacity-50 border border-slate-700/50 transition-colors"},o(e.$t("tools.gifEditor.preview.moveDown")),9,Xe),t("button",{onClick:N,disabled:i.value.length<=1,class:"px-3 py-1 bg-slate-800/50 text-slate-300 rounded text-sm hover:bg-slate-700/50 disabled:opacity-50 border border-slate-700/50 transition-colors"},o(e.$t("tools.gifEditor.preview.reverse")),9,Ze),t("button",{onClick:A,disabled:i.value.length<=1,class:"px-3 py-1 bg-slate-800/50 text-slate-300 rounded text-sm hover:bg-slate-700/50 disabled:opacity-50 border border-slate-700/50 transition-colors"},o(e.$t("tools.gifEditor.preview.shuffle")),9,et)])])]),t("div",tt,[t("button",{onClick:H,disabled:E.value||i.value.length===0,class:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:bg-slate-700 disabled:cursor-not-allowed transition-colors font-medium"},o(E.value?e.$t("common.loading"):e.$t("tools.gifEditor.actions.generateGif")),9,st),t("button",{onClick:I,class:"px-4 py-2 bg-red-600/10 text-red-300 rounded-lg hover:bg-red-600/20 border border-red-600/30 hover:border-red-600/50 transition-colors font-medium"},o(e.$t("common.clear")),1)])])):F("",!0),E.value?(p(),h("div",ot,[t("div",lt,[s[10]||(s[10]=t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"},null,-1)),t("h3",it,o(e.$t("tools.gifEditor.processing.title")),1),t("p",rt,o(e.$t("tools.gifEditor.processing.description")),1),t("div",at,[t("div",{class:"bg-primary-500 h-2 rounded-full transition-all duration-300",style:ne({width:b.value+"%"})},null,4)]),t("p",nt,o(b.value)+"%",1),u.value?(p(),h("div",dt,[t("h4",ut,o(e.$t("tools.gifEditor.processing.preview")),1),t("img",{src:u.value,alt:"GIF Preview",class:"max-w-full h-auto mx-auto rounded-lg shadow-lg",style:{"max-height":"200px"}},null,8,ct)])):F("",!0)])])):F("",!0),u.value?(p(),h("div",gt,[t("h3",ft,o(e.$t("tools.gifEditor.result.title")),1),t("div",mt,[t("img",{src:u.value,alt:"Generated GIF",class:"max-w-full h-auto mx-auto rounded-lg shadow-lg mb-4"},null,8,pt),t("div",ht,[t("button",{onClick:Q,class:"px-6 py-2 bg-green-600/10 text-green-300 rounded-lg hover:bg-green-600/20 border border-green-600/30 hover:border-green-600/50 transition-colors font-medium"},o(e.$t("tools.gifEditor.result.download")),1),t("button",{onClick:Y,class:"px-6 py-2 bg-slate-800/50 text-slate-300 rounded-lg hover:bg-slate-700/50 border border-slate-700/50 transition-colors font-medium"},o(e.$t("tools.gifEditor.result.createNew")),1)])])])):F("",!0),t("div",vt,[t("h3",bt," ðŸ’¡ "+o(e.$t("tools.gifEditor.tips.title")),1),t("ul",wt,[t("li",yt,[s[11]||(s[11]=t("span",{class:"mr-2"},"â€¢",-1)),t("span",null,o(e.$t("tools.gifEditor.tips.tip1")),1)]),t("li",xt,[s[12]||(s[12]=t("span",{class:"mr-2"},"â€¢",-1)),t("span",null,o(e.$t("tools.gifEditor.tips.tip2")),1)]),t("li",Et,[s[13]||(s[13]=t("span",{class:"mr-2"},"â€¢",-1)),t("span",null,o(e.$t("tools.gifEditor.tips.tip3")),1)]),t("li",_t,[s[14]||(s[14]=t("span",{class:"mr-2"},"â€¢",-1)),t("span",null,o(e.$t("tools.gifEditor.tips.tip4")),1)])])])]),_:1},8,["title","description","features"]))}}),Rt=de($t,[["__scopeId","data-v-71aedc54"]]);export{Rt as default};
